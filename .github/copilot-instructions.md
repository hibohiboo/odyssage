# Odyssage プロジェクト Copilot 指示書

このファイルは GitHub Copilot の指示書のインデックスです。特定のコンテキストに応じて、適切な指示書ファイルを参照してください。

## 指示書ファイル一覧

- [基本指示書](./copilot-instructions/base.md) - ソフトウェア設計原則、コーディングスタイル、リポジトリ構造
- [命名規則](./copilot-instructions/naming.md) - 変数、関数、クラスの命名規則
- [テスト指示書](./copilot-instructions/testing.md) - テスト駆動開発のフロー、テストケースの書き方
- [フロントエンド指示書](./copilot-instructions/frontend.md) - フロントエンド特有の規約、Feature-Sliced Design
- [バックエンド指示書](./copilot-instructions/backend.md) - バックエンド特有の規約、API実装ガイドライン
- [ドキュメント指示書](./prompts/docs.prompt.md)
- [プロジェクトの開発ルールとAI Agent動作基準](./prompts/project-development-rules.prompt.md)

## 使い方

Copilot に指示を出す際、以下のようなコメントを入れることで特定のコンテキストを指定できます：

```typescript
// @copilot-context frontend
// ここにフロントエンド関連の質問やコード作成の指示

// @copilot-context backend
// ここにバックエンド関連の質問やコード作成の指示

// @copilot-context base
// 基本的なコーディングスタイルや設計原則に関する質問

// @copilot-context testing
// テスト関連の質問やコード作成

// @copilot-context naming
// 命名規則に関する質問
```

コンテキストが指定されていない場合は、デフォルトで基本指示書が使用されます。

## 必須コンテキスト指定

以下のタイプのファイルを作成する場合は、必ず対応するコンテキスト指定を行ってください：

### テストファイル作成時（必須）

テストファイルを作成または編集する際は、**必ず**ファイルの先頭に以下のコメントを追加してください：

```typescript
// @copilot-context testing
```

これにより、テスト駆動開発の原則に従った適切なテスト実装が促進されます。特に：

- テストは一度にすべて実装せず、1ケースずつ段階的に実装されます
- データベースタイプ（RDB/GraphDB）に適した手法が適用されます
- Honoエンドポイントの適切なテスト方法が提供されます

### フロントエンドファイル作成時（必須）

React コンポーネントやフック、フロントエンド関連のファイル作成・編集時は、必ずファイルの先頭に以下のコメントを追加してください：

```typescript
// @copilot-context frontend
```

これにより、以下のようなフロントエンド固有の規約が適用されます：

- Feature-Sliced Design に則ったコンポーネント設計と配置
- UI と ロジックの適切な分離（カスタムフックの活用）
- 適切なインポート・エクスポートルールの適用
- コンポーネント間のデータフローに一貫性を持たせる

### バックエンドファイル作成時（必須）

API実装やルート定義、データベースアクセス関連のファイル作成・編集時は、必ずファイルの先頭に以下のコメントを追加してください：

```typescript
// @copilot-context backend
```

これにより、以下のようなバックエンド固有の規約が適用されます：

- OpenAPIドキュメントとの一貫性が保たれる
- 適切なバリデーションスキーマの作成と適用
- 一貫した命名規則の適用（リクエスト/レスポンス間）
- データベース固有のアクセスパターンの適用

### データスキーマ定義時（必須）

データモデルやスキーマ定義を行う際は、必ずファイルの先頭に以下のコメントを追加してください：

```typescript
// @copilot-context naming
```

これにより、以下のような命名規則が適用されます：

- プロジェクト全体で一貫した変数、関数、クラス命名規則
- データベースとAPIの間の命名規則の一貫性を保つ
- 変数型に応じた適切な命名パターンの選択

## コンテキスト別の適用範囲

### base - 基本指示書

- ソフトウェア設計原則（SOLID、KISS、YAGNI、DRY等）
- 基本的なコーディングスタイル
- リポジトリ構造や共通ライブラリ

### naming - 命名規則

- 変数、関数、クラス、フォルダなどの命名規則
- 言語要素別の命名パターン

### testing - テスト指示書

- テスト駆動開発の実践方法
  - **重要**: テストは一度にすべて実装せず、1ケースずつ段階的に実装
  - 段階的なテスト実装により、複雑なエラーを防止
- テストケースの記述スタイル
- テスト時の注意点
- データベース別テスト手法（RDB/GraphDB）の違い
- Honoエンドポイントでの直接テスト手法

### frontend - フロントエンド指示書

- React、Feature-Sliced Designの活用
- フロントエンド固有のベストプラクティス
- コンポーネント設計やステート管理

### backend - バックエンド指示書

- API設計・実装のガイドライン
- データベースアクセスのパターン
- バックエンド固有のベストプラクティス
- **必須**: APIを追加する際は OpenAPI ドキュメント（docs\redocly\openapi\api.yaml）への追記

## YAMLファイル編集ガイドライン

- YAMLファイルを編集する際は、インデントと改行に特に注意すること
- 既存のYAMLファイルの構造を維持し、不要な改行を挿入しないこと
- OpenAPIドキュメントなどのYAMLファイルを更新する場合は、編集前後で構文が崩れていないことを確認すること
- YAMLの階層構造を維持するために、同じレベルの要素には同じインデントを使用すること

## コードレビュープロセスの改善

効果的なコードレビューのために、以下のプラクティスを導入してください：

### レビュー前の準備

- Pull Requestの説明には、対応するコンテキスト指定（`@copilot-context xxx`）を明記する
- 変更内容に応じた適切なチェックリスト項目を含める

### ファイルタイプ別チェックリスト

#### テストコードレビュー

- [ ] ファイル先頭に `@copilot-context testing` が記載されている
- [ ] テスト駆動開発の原則に従い、1ケースずつ段階的に実装されている
- [ ] トグルフラグを使用してテスト対象が制御できるようになっている
- [ ] データベースタイプ（RDB/GraphDB）に応じた適切な手法が使用されている

#### フロントエンドコードレビュー

- [ ] ファイル先頭に `@copilot-context frontend` が記載されている
- [ ] Feature-Sliced Designに従ったファイル構成と配置になっている
- [ ] UIとロジックが適切に分離されている（カスタムフック活用）
- [ ] プロジェクト全体で一貫したインポート・エクスポートルールが使用されている

#### バックエンドコードレビュー

- [ ] ファイル先頭に `@copilot-context backend` が記載されている
- [ ] OpenAPIドキュメントが更新されている（API追加・変更時）
- [ ] バリデーションスキーマを適切に定義・使用している
- [ ] データベース固有のアクセスパターンが守られている

### コードレビュー時の確認

- ファイルごとに適切なコンテキスト指定が行われていることを確認
- 各コンテキスト固有の規約やベストプラクティスが遵守されていることを検証
- 命名規則の一貫性を確認（特にAPI間、UI間の連携で重要）

### 自動レビュープロセス

- コミット前にpre-commitフックでコンテキスト指定の有無をチェック
- PRテンプレートにコンテキスト指定の確認項目を含める
- CI/CDパイプラインで各コンテキスト固有のリンターを実行

## 注意事項

- 新しい機能や大きな変更を加える場合は、関連する指示書を必ず参照してください
- 指示書間で矛盾がある場合は、より専門的なコンテキストの指示書を優先してください（例：命名規則とフロントエンド指示書で矛盾がある場合、フロントエンドの文脈ではフロントエンド指示書を優先）
- 各ファイルには**必ず**適切なコンテキスト指定（`@copilot-context xxx`）を含めてください
