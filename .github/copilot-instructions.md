# Copilot Instructions
## ソフトウェア設計

- 単一責任の原則に従う。クラス・関数は１つの役割のみを実行すること
- 依存性逆転の原則に従う。外部の依存関係はインターフェースを介して注入すること
- KISS原則に従う。可能な限り複雑さを避け、シンプルで誰にでも理解しやすいアーキテクチャとすること
- YAGNI原則に従う。今必要ないものは作らないこと
- DRY原則に従う。無駄な重複は避けること。ただし、過度な共通化はしないこと。


## コーディングスタイル
- 条件文ではネストを避け、コードの可読性を高めるために早期リターンを使用すること
- クラス及び関数には適切なドキュメントコメントを追加する。各関数やクラスにはその目的や使用方法を説明するコメントを追加すること
- 実装はテスト駆動開発で実施する
  - プロンプトに記載された要件からテストリストを作成すること
  - テストリストを元にテストコードを記述すること
  - テストが通るようにプロダクトコードを記述すること
  - 必ずリファクタリングを実装するか確認すること
  - リファクタリング後はCyclomatic complexityが7以下になるようにすること
  - プロダクトコードとテストコードは一度にすべて記載しないこと
  - テストリストの1ケースずつ実装を進めること
- テストケースは日本語で記載すること
- 関数の宣言位置は使用箇所より前とすること
- コードを直訳はコメントに書かず、何故そのコードにしたのかを記載する
    - bad: `setDefaultTimeout(60 * 1000);` に `// タイムアウトを60秒に設定`
    - good: `setDefaultTimeout(60 * 1000);` に `// 時間がかかるテストなのでタイムアウトを延長 （デフォルトは5秒）`
## 命名規則
- 一般的な用語以外は単語を省略せずに記載すること
  - good: errorCount, dnsConnectionIndex
  - bad: errCnt, dnsIdx
- 変数、定数、カラム名の命名規則
  - 日時を示す場合: 動詞 + at
    - 例: createdAt, allowAt
  - 値がboolean以外の場合： 形容詞 + 名詞
    - 例: allAnimal, freeWord
  - 存在有無を表現するboolean: has + 名詞
    - 例: hasAnimal
- 関数、クラスの命名規則
  - イベント関数: on + 名詞 + 形容詞
    - 例: onArrivalJust, onWageLost
  - 変換、成形関数: to + 名詞
    - 例: toUser, toAnimal
  - 状態を変更: 動詞 + 目的語 + 形容詞
    - 例: deleteUserOld

## フォルダ階層
- フォルダ名は小文字を用いる

## リポジトリ構造

```
odysseyage/
├── apps/
│   ├── backend/             # バックエンドアプリケーション
│   ├── frontend/            # フロントエンドアプリケーション
│   │   ├── src/
│   │   │   ├── app/         # グローバルなアプリケーション設定（ルート、状態管理など）
│   │   │   ├── entities/    # ドメインエンティティ（Character, Scenarioなど）
│   │   │   ├── features/    # ドメイン機能（キャラクター管理、シナリオ管理など）
│   │   │   ├── pages/       # ページコンポーネント
│   │   │   ├── shared/      # 共通コンポーネント、ユーティリティ
│   │   │   └── widgets/     # UIウィジェット（ヘッダー、フッターなど）
├── packages/
│   ├── schema/              # バリデーションスキーマ。データスキーマ。
│   ├── database/            # データベーススキーマ（インフラ層）。永続化層アダプタ（リポジトリの実装）
│   ├── ui/                  # UIコンポーネントライブラリ
│   ├── lib/                 # 共通ユーティリティ
│   ├── bdd-e2e-test/        # ふるまい駆動のe2eテスト
│   ├── typescript-config    # tsconfig設定
│   └── eslint-config-custom # eslint設定
├── docs/                    # 設計ドキュメント
```

## 共通利用ライブラリ
用途|ライブラリ
--|--
テスト|vitest
言語|typescript

## フロントエンド
### フロントエンド利用ライブラリ

用途|ライブラリ
--|--
フロントエンドからバックエンドへの通信|hono rpc
フロントエンドUIライブラリ|react
ページ遷移ライブラリ|react-router
ライブラリ管理|bun



### フロントエンドの規約
- フロントエンドはFeature-Sliced Designのディレクトリ構成とする
- ビジネスロジックとUIコンポーネントを分けるため、hooksを利用する。
- 再利用可能なUIコンポーネントは packages\ui 以下に記載する
- packages\ui以下にUIコンポーネントを作成したときは、 StorybookのStoryも記載する

### 利用しないライブラリ
- react-router-dom は使わない。 react-router を利用する。

### 利用しない関数
- バックエンドとの通信は fetch ではなく hono rpc を利用する。

## バックエンド
### バックエンド利用ライブラリ

用途|ライブラリ
--|--
バックエンドフレームワーク|hono

### バックエンドの規約
- APIを追加するときには docs\redocly\openapi\api.yaml にOpenAPIで追記すること。説明は日本語で書くこと
- APIのバリデーションは packages\schema にバリデーションスキーマを定義してそれを利用すること
- RDBを利用するときは packages\database 以下のファイルを永続化層アダプタとして利用すること
- RDBを利用するときにテーブル定義が不足していた場合は packages\database 以下でコードファーストで作成すること


